@{
    ViewData["Title"] = "📊 Thống kê vé & doanh thu (Firestore thật)";
    Layout = "_Layout";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container mt-4">
    <h2 class="fw-bold text-primary text-center mb-5">📈 Vé & Doanh thu theo tháng</h2>

    <div class="card shadow border-0 rounded-4 p-4 mb-5">
        <canvas id="chartTicketsRevenue" style="max-width: 950px; max-height: 520px;"></canvas>
    </div>

    <h2 class="fw-bold text-success text-center mb-4">🛫 Thống kê theo Hãng bay</h2>
    <div class="card shadow border-0 rounded-4 p-4">
        <canvas id="chartAirline" style="max-width: 950px; max-height: 520px;"></canvas>
    </div>
</div>

<script>
    const months = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.Months));
    const ticketCounts = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.TicketCounts));
    const revenues = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.Revenues));

    const airlineNames = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.AirlineNames));
    const airlineTickets = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.AirlineTickets));
    const airlineRevenue = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.AirlineRevenue));


        // ✅ Thêm điểm 0 đầu tiên
    const monthsWithZero = ['Bắt đầu', ...months];
    const revenuesWithZero = [0, ...revenues];
    const ticketCountsWithZero = [0, ...ticketCounts];

    // 🎨 Biểu đồ song song (vé & doanh thu)
    new Chart(document.getElementById('chartTicketsRevenue'), {
        data: {
            labels: months,
            datasets: [
                {
                    type: 'bar',
                    label: 'Số vé bán được',
                    data: ticketCounts,
                    backgroundColor: 'rgba(54, 162, 235, 0.8)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    borderRadius: 8,
                    yAxisID: 'yTickets'
                },
                {
                    type: 'line',
                    label: 'Doanh thu (triệu ₫)',
                    data: revenues,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)', // 🔴 Màu đỏ nhạt
                    borderColor: 'rgba(255, 99, 132, 1)',        // 🔴 Màu đỏ đậm cho đường viền
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    yAxisID: 'yRevenue'
                }
            ]
        },
        options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { labels: { font: { size: 13 } } },
                title: { display: true, text: '📊 Vé & Doanh thu theo tháng (Song song)', font: { size: 16 } }
            },
            scales: {
                yTickets: {
                    type: 'linear',
                    position: 'left',
                    beginAtZero: true,
                    title: { display: true, text: 'Số vé' }
                },
                yRevenue: {
                    type: 'linear',
                    position: 'right',
                    beginAtZero: true,
                    grid: { drawOnChartArea: false },
                    title: { display: true, text: 'Doanh thu (triệu ₫)' },
                    ticks: { callback: (v) => v + ' triệu' }
                }
            }
        }
    });

    // ✈️ Biểu đồ hãng bay
    new Chart(document.getElementById('chartAirline'), {
        type: 'bar',
        data: {
            labels: airlineNames,
            datasets: [
                {
                    label: 'Số vé',
                    data: airlineTickets,
                    backgroundColor: 'rgba(255, 159, 64, 0.8)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 2,
                    borderRadius: 6
                },
                {
                    label: 'Doanh thu (triệu ₫)',
                    data: airlineRevenue,
                    backgroundColor: 'rgba(153, 102, 255, 0.8)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 2,
                    borderRadius: 6
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { labels: { font: { size: 13 } } },
                title: { display: true, text: '🛫 Vé & Doanh thu theo Hãng bay', font: { size: 16 } }
            },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Số lượng / Triệu ₫' } }
            }
        }
    });
</script>
